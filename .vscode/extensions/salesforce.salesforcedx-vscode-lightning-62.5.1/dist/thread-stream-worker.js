"use strict";var X=Object.defineProperty;var n=(e,t)=>X(e,"name",{value:t,configurable:!0});var R=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var D=R((j,w)=>{var q=new Function("modulePath","return import(modulePath)");function U(e){return typeof __non_webpack__require__=="function"?__non_webpack__require__(e):require(e)}n(U,"realRequire");w.exports={realImport:q,realRequire:U}});var M=R((P,T)=>{"use strict";T.exports={WRITE_INDEX:4,READ_INDEX:8}});var y=R((v,h)=>{"use strict";function x(e,t,a,A,i){let E=Date.now()+A,s=Atomics.load(e,t);if(s===a){i(null,"ok");return}let f=s,u=n(I=>{Date.now()>E?i(null,"timed-out"):setTimeout(()=>{f=s,s=Atomics.load(e,t),s===f?u(I>=1e3?1e3:I*2):s===a?i(null,"ok"):i(null,"not-equal")},I)},"check");u(1)}n(x,"wait");function k(e,t,a,A,i){let E=Date.now()+A,s=Atomics.load(e,t);if(s!==a){i(null,"ok");return}let f=n(u=>{Date.now()>E?i(null,"timed-out"):setTimeout(()=>{s=Atomics.load(e,t),s!==a?i(null,"ok"):f(u>=1e3?1e3:u*2)},u)},"check");f(1)}n(k,"waitDiff");h.exports={wait:x,waitDiff:k}});var{realImport:W,realRequire:d}=D(),{workerData:g,parentPort:_}=require("worker_threads"),{WRITE_INDEX:p,READ_INDEX:r}=M(),{waitDiff:N}=y(),{dataBuf:S,filename:l,stateBuf:C}=g,c,o=new Int32Array(C),O=Buffer.from(S);async function b(){let e;try{l.endsWith(".ts")||l.endsWith(".cts")?(process[Symbol.for("ts-node.register.instance")]?process.env.TS_NODE_DEV&&d("ts-node-dev"):d("ts-node/register"),e=d(decodeURIComponent(l.replace(process.platform==="win32"?"file:///":"file://","")))):e=await W(l)}catch(t){if((t.code==="ENOTDIR"||t.code==="ERR_MODULE_NOT_FOUND")&&l.startsWith("file://"))e=d(decodeURIComponent(l.replace("file://","")));else if(t.code===void 0||t.code==="ERR_VM_DYNAMIC_IMPORT_CALLBACK_MISSING")try{e=d(decodeURIComponent(l.replace(process.platform==="win32"?"file:///":"file://","")))}catch{throw t}else throw t}typeof e=="object"&&(e=e.default),typeof e=="object"&&(e=e.default),c=await e(g.workerData),c.on("error",function(t){Atomics.store(o,p,-2),Atomics.notify(o,p),Atomics.store(o,r,-2),Atomics.notify(o,r),_.postMessage({code:"ERROR",err:t})}),c.on("close",function(){let t=Atomics.load(o,p);Atomics.store(o,r,t),Atomics.notify(o,r),setImmediate(()=>{process.exit(0)})})}n(b,"start");b().then(function(){_.postMessage({code:"READY"}),process.nextTick(m)});function m(){let e=Atomics.load(o,r),t=Atomics.load(o,p);if(t===e){t===O.length?N(o,r,t,1/0,m):N(o,p,t,1/0,m);return}if(t===-1){c.end();return}let a=O.toString("utf8",e,t);c.write(a)?(Atomics.store(o,r,t),Atomics.notify(o,r),setImmediate(m)):c.once("drain",function(){Atomics.store(o,r,t),Atomics.notify(o,r),m()})}n(m,"run");process.on("unhandledRejection",function(e){_.postMessage({code:"ERROR",err:e}),process.exit(1)});process.on("uncaughtException",function(e){_.postMessage({code:"ERROR",err:e}),process.exit(1)});process.once("exit",e=>{if(e!==0){process.exit(e);return}c?.writableNeedDrain&&!c?.writableEnded&&_.postMessage({code:"WARNING",err:new Error("ThreadStream: process exited before destination stream was drained. this may indicate that the destination stream try to write to a another missing stream")}),process.exit(0)});
